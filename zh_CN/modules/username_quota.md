# 用户名配额限制

从 4.4.25 版本开始，新增了用户名配额限制模块，用以限制单个 MQTT 用户名的最大会话数。

当某个用户名超过配额后，新的会话将被拒绝连接，CONNACK 返回码为 “0x97 配额已超”（MQTT 5.0）或者 “0x03 服务不可用”（MQTT 3.1.1）。

## 创建模块

1. 打开 [EMQX Dashboard](http://127.0.0.1:18083/#/modules)，点击左侧的 “模块” 选项卡，选择 “添加模块”。

2. 选择 “用户名配额限制” 模块，配置相关参数，然后点击 “添加”。

   ![user-quota-create](./assets/user-quota-create-zh.png)

## 参数设置

用户名配额限制模块支持以下参数：

- **用户名的最大会话数**: 指定每个用户名允许登录的最大 MQTT 会话数。注意如果 MQTT 客户端是使用持久会话方式登录的，那么当客户端断开连接后，会话仍然保留在服务器上，直到会话过期才会被清除。

- **用户名白名单**: 可以通过右侧的 “添加” 按钮添加白名单用户名。白名单中的用户名不受会话数限制。例如，如果需要让连接到本集群的 MQTT 桥接客户端绕过配额限制，可以将 MQTT 桥接使用的用户名添加到白名单中。

## 使用示例

1. 打开 [EMQX Dashboard](http://127.0.0.1:18083/#/modules)，点击左侧的 “模块” 选项卡，点击我们已经添加过的 “用户名配额限制”。

2. 在 “使用详情” 页面，可以看到 EMQX 集群中当前的用户名以及每个用户名的会话数。点击会话数旁边 “查看”按钮，可以查看当前用户名的会话列表。

   ![user-quota-usage](./assets/user-quota-usage-zh.png)
